#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
PKCS#7 Padding - добавляет байты чтобы текст делился на 16
"""
from typing import Optional


class PKCS7Дополнение:
    """Добавляет и удаляет дополнение PKCS#7"""
    
    РАЗМЕР_БЛОКА = 16  # AES работает с блоками по 16 байт
    
    @staticmethod
    def добавить_дополнение(данные: bytes) -> bytes:
        """
        Добавляет байты в конец чтобы размер стал кратен 16
        Пример: если текст 10 байт, добавит 6 байт со значением 6
        """
        # Сколько байт нужно добавить?
        сколько_добавить = PKCS7Дополнение.РАЗМЕР_БЛОКА - (len(данные) % PKCS7Дополнение.РАЗМЕР_БЛОКА)
        
        # Если данные уже кратны 16, все равно добавляем целый блок
        if сколько_добавить == 0:
            сколько_добавить = PKCS7Дополнение.РАЗМЕР_БЛОКА
        
        # Создаем байты для дополнения (повторяем число сколько_добавить)
        дополнение = bytes([сколько_добавить] * сколько_добавить)
        
        # Возвращаем данные + дополнение
        return данные + дополнение
    
    @staticmethod
    def удалить_дополнение(данные: bytes) -> Optional[bytes]:
        """
        Удаляет дополнение PKCS#7
        Проверяет что дополнение правильное
        """
        if not данные:
            return None
        
        # Последний байт говорит сколько байт дополнения
        размер_дополнения = данные[-1]
        
        # Проверяем что размер дополнения правильный (1-16)
        if размер_дополнения < 1 or размер_дополнения > PKCS7Дополнение.РАЗМЕР_БЛОКА:
            return None
        
        # Проверяем что все байты дополнения одинаковые
        if данные[-размер_дополнения:] != bytes([размер_дополнения] * размер_дополнения):
            return None
        
        # Возвращаем данные без дополнения
        return данные[:-размер_дополнения]
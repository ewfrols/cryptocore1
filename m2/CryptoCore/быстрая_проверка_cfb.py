#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Быстрая проверка CFB с файлом более 16 байт
"""
import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from cryptocore.modes.cfb import CFBMode

# Тестовые данные (больше 16 байт)
тестовые_данные = b"Test file for all AES modes\r\nLine 2: Testing encryption and decryption"
ключ = "000102030405060708090a0b0c0d0e0f"
iv = b"0123456789abcdef"

print("=" * 60)
print("ПРОВЕРКА CFB С ФАЙЛОМ >16 БАЙТ")
print("=" * 60)

print(f"Длина данных: {len(тестовые_данные)} байт")
print(f"Ключ: {ключ}")
print(f"IV: {iv.hex()}")
print(f"Первые 32 байта данных: {тестовые_данные[:32]}")

cfb = CFBMode(ключ)

# Шифруем
зашифрованные = cfb.зашифровать(тестовые_данные, iv)
print(f"\nЗашифровано: {len(зашифрованные)} байт")

# Расшифровываем
расшифрованные = cfb.расшифровать(зашифрованные, iv)
print(f"Расшифровано: {len(расшифрованные)} байт")

# Проверяем
if тестовые_данные == расшифрованные:
    print("✓ УСПЕХ: Данные совпадают!")
    print("  CFB работает правильно с файлами >16 байт")
else:
    print("✗ ОШИБКА: Данные не совпадают")
    
    # Находим первое отличие
    for i in range(min(len(тестовые_данные), len(расшифрованные))):
        if тестовые_данные[i] != расшифрованные[i]:
            print(f"  Первое отличие на байте {i}:")
            print(f"    Оригинал: 0x{тестовые_данные[i]:02x} (символ: {repr(chr(тестовые_данные[i]))})")
            print(f"    Результат: 0x{расшифрованные[i]:02x} (символ: {repr(chr(расшифрованные[i]))})")
            
            # Покажем контекст
            start = max(0, i - 5)
            end = min(len(тестовые_данные), i + 5)
            print(f"    Контекст оригинала: {тестовые_данные[start:end]}")
            print(f"    Контекст результата: {расшифрованные[start:end]}")
            break

print("\n" + "="*60)